<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oris - Mentalização Planetária</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root { --accent: #9c27b0; --glow: #ce93d8; }
        
        body, html { 
            margin: 0; padding: 0; height: 100%; overflow: hidden; 
            background-color: #020205; color: white; font-family: 'Segoe UI', sans-serif; 
        }

        #map { width: 100%; height: 100%; position: absolute; top: 0; left: 0; opacity: 0; transition: opacity 3s; }

        #subtitles {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 600px;
            background: rgba(5, 5, 10, 0.7);
            backdrop-filter: blur(8px);
            padding: 15px 25px;
            border-radius: 20px;
            border: 1px solid var(--accent);
            text-align: center;
            font-size: 1.4rem;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 1s;
        }

        @media (max-width: 600px) {
            #subtitles {
                bottom: 20px;
                padding: 10px 15px;
                font-size: 1rem;
                width: 85%;
            }
            .leaflet-bottom { bottom: 85px !important; }
        }

        .leaflet-container { background: #020205 !important; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="subtitles">Iniciando busca por sua luz...</div>

    <script>
        // Configuração inicial do mapa
        let map = L.map('map', { zoomControl: false, attributionControl: false }).setView([0, 0], 2);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

        // Coordenada padrão (São Paulo) caso o GPS falhe
        let userCoords = { lat: -23.5505, lon: -46.6333 }; 
        const subtitleDiv = document.getElementById('subtitles');

        async function localizarUsuario() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    exibirMensagem("Seu navegador não suporta geolocalização. Usando conexão padrão.");
                    resolve(userCoords);
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userCoords = {
                            lat: position.coords.latitude,
                            lon: position.coords.longitude
                        };
                        resolve(userCoords);
                    },
                    (error) => {
                        let msg = "";
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                msg = "Sua localização está oculta. Conectando pelo centro da rede.";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                msg = "Sinal de GPS fraco. Sintonizando frequência padrão.";
                                break;
                            case error.TIMEOUT:
                                msg = "Tempo esgotado. Estabilizando conexão em ponto seguro.";
                                break;
                            default:
                                msg = "Conectando ao fluxo planetário...";
                        }
                        exibirMensagem(msg);
                        resolve(userCoords); // Resolve com a coordenada padrão
                    },
                    { timeout: 10000 }
                );
            });
        }

        function exibirMensagem(texto) {
            subtitleDiv.innerText = texto;
            subtitleDiv.style.opacity = "1";
        }

        async function iniciarFluxo() {
            // 1. Tenta localizar
            const coords = await localizarUsuario();
            map.setView([coords.lat, coords.lon], 2);
            
            // 2. Inicia animação de zoom mística
            const niveisZoom = [2, 5, 10, 14, 18];
            for (let z of niveisZoom) {
                map.flyTo([coords.lat, coords.lon], z, {
                    animate: true,
                    duration: 3
                });
                
                // Mensagens variam conforme o zoom
                if(z === 5) exibirMensagem("Localizando sua presença na Terra...");
                if(z === 10) exibirMensagem("Sincronizando com os irmãos próximos...");
                if(z === 18) exibirMensagem("Conexão estabelecida. Respire com o planeta.");
                
                await new Promise(r => setTimeout(r, 4500));
            }
        }

        window.onload = () => {
            document.getElementById('map').style.opacity = "1";
            iniciarFluxo();
        };
    </script>
</body>
</html>